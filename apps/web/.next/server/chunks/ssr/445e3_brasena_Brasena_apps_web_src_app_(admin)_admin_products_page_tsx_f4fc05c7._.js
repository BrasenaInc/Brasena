module.exports=[54276,a=>{"use strict";var b=a.i(53077),c=a.i(97176),d=a.i(30466),e=a.i(20568),f=a.i(81033),g=a.i(43249);let h=(0,g.default)("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]),i=(0,g.default)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),j=(0,g.default)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),k=(0,g.default)("Pencil",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]),l=(0,g.default)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);var m=a.i(13693),n=a.i(2979),o=a.i(41588),p=a.i(76828);let q=(0,g.default)("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);var r=a.i(48764),s=a.i(77241),t=a.i(42205),u=a.i(33397),v=a.i(39681);function w(a){return a.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,"")}function x({category:a}){switch(a){case"Beef":return(0,b.jsx)(m.Beef,{className:"h-5 w-5",style:{color:"var(--text3)"}});case"Pork":return(0,b.jsx)(n.UtensilsCrossed,{className:"h-5 w-5",style:{color:"var(--text3)"}});case"Chicken":return(0,b.jsx)(o.Bird,{className:"h-5 w-5",style:{color:"var(--text3)"}});default:return(0,b.jsx)(p.Package,{className:"h-5 w-5",style:{color:"var(--text3)"}})}}function y(){let a=(0,t.useSupabase)(),g=(0,e.useQueryClient)(),[m,n]=(0,c.useState)(""),[o,p]=(0,c.useState)("All"),[w,y]=(0,c.useState)(!1),[B,C]=(0,c.useState)(null),[D,E]=(0,c.useState)(null),{data:F=[],isLoading:G}=(0,d.useQuery)({queryKey:["admin-products"],queryFn:async()=>{let{data:b,error:c}=await a.from("products").select("*").order("created_at",{ascending:!1});if(c)throw c;if(!b?.length)return[];let d=b.map(a=>a.id),{data:e,error:f}=await a.from("weight_tiers").select("*").in("product_id",d);if(f)throw f;let g=(e??[]).reduce((a,b)=>(a[b.product_id]||(a[b.product_id]=[]),a[b.product_id].push(b),a),{});return b.map(a=>({...a,weight_tiers:g[a.id]??[]}))}}),H=(0,c.useMemo)(()=>{let a=F;if(m.trim()){let b=m.toLowerCase();a=a.filter(a=>a.name.toLowerCase().includes(b))}return"All"!==o&&(a=a.filter(a=>a.category===o)),a},[F,m,o]),I=F.filter(a=>a.in_stock).length,J=s.BUSINESS.MAX_PHASE_1_PRODUCTS,K=F.length,L=Math.max(0,J-K),M=(0,c.useCallback)(()=>{C(null),y(!0)},[]),N=(0,c.useCallback)(a=>{C(a),y(!0)},[]),O=(0,c.useCallback)(()=>{y(!1),C(null)},[]);return(0,b.jsxs)("div",{className:"flex flex-col h-full overflow-hidden",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between px-6 py-4 border-b",style:{borderColor:"var(--border)"},children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"font-display text-2xl font-semibold",style:{color:"var(--text-primary)"},children:"Products"}),(0,b.jsxs)("p",{className:"text-sm mt-0.5",style:{color:"var(--text3)"},children:[K," of ",J," Phase 1 slots used"]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)(u.ThemeToggle,{}),(0,b.jsxs)("button",{type:"button",className:"btn-ghost min-h-[44px] flex items-center gap-2 px-4",children:[(0,b.jsx)(j,{className:"h-4 w-4"}),"Import CSV"]}),(0,b.jsxs)("button",{type:"button",onClick:M,className:"btn-primary min-h-[44px] flex items-center gap-2 px-4",children:[(0,b.jsx)(i,{className:"h-4 w-4"}),"Add Product"]})]})]}),(0,b.jsxs)("div",{className:"flex-1 overflow-auto p-6",children:[(0,b.jsx)("div",{className:"grid grid-cols-4 gap-4 mb-6",children:[{label:"TOTAL PRODUCTS",value:F.length,change:null},{label:"IN STOCK",value:I,change:"up"},{label:"LOW STOCK",value:0,change:null},{label:"PHASE 1 LIMIT",value:J,sub:`${L} slots remaining`}].map(a=>(0,b.jsxs)("div",{className:"rounded-[14px] border p-4",style:{background:"var(--card)",borderColor:"var(--border)"},children:[(0,b.jsx)("p",{className:"font-mono text-2xl font-medium",style:{color:"var(--text-primary)"},children:a.value}),(0,b.jsx)("p",{className:"text-xs uppercase mt-1",style:{color:"var(--text3)"},children:a.label}),a.sub&&(0,b.jsx)("p",{className:"text-xs mt-0.5",style:{color:"var(--text3)"},children:a.sub}),a.change&&(0,b.jsx)("span",{className:"inline-flex mt-1",children:"up"===a.change?(0,b.jsx)(q,{className:"h-4 w-4",style:{color:"var(--color-success)"}}):(0,b.jsx)(r.TrendingDown,{className:"h-4 w-4",style:{color:"var(--color-error)"}})})]},a.label))}),(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-3 mb-4",children:[(0,b.jsxs)("div",{className:"relative flex-1 min-w-[200px] max-w-sm",children:[(0,b.jsx)(f.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4",style:{color:"var(--text3)"}}),(0,b.jsx)("input",{type:"search",placeholder:"Search products...",value:m,onChange:a=>n(a.target.value),className:"input pl-10 min-h-[44px]",style:{background:"var(--card)",borderColor:"var(--border)"}})]}),["All",...s.BUSINESS.CATEGORIES].map(a=>(0,b.jsx)("button",{type:"button",onClick:()=>p(a),className:(0,v.cn)("px-4 py-2 rounded-full text-sm font-medium min-h-[44px] border",o===a?"border-[var(--sage)]":"border-[var(--border)]"),style:{background:o===a?"var(--sage-bg)":"var(--card)",color:o===a?"var(--sage)":"var(--text-secondary)"},children:a},a)),(0,b.jsxs)("button",{type:"button",className:"btn-ghost min-h-[44px] flex items-center gap-2 px-4",children:[(0,b.jsx)(h,{className:"h-4 w-4"}),"Filter"]})]}),(0,b.jsx)("div",{className:"rounded-xl border overflow-hidden",style:{borderColor:"var(--border)",background:"var(--card)"},children:(0,b.jsxs)("table",{className:"w-full text-left",children:[(0,b.jsx)("thead",{children:(0,b.jsxs)("tr",{className:"border-b",style:{borderColor:"var(--border)"},children:[(0,b.jsx)("th",{className:"p-3 text-xs uppercase font-semibold w-14",style:{color:"var(--text3)"}}),(0,b.jsx)("th",{className:"p-3 text-xs uppercase font-semibold",style:{color:"var(--text3)"},children:"Product"}),(0,b.jsx)("th",{className:"p-3 text-xs uppercase font-semibold",style:{color:"var(--text3)"},children:"Category"}),(0,b.jsx)("th",{className:"p-3 text-xs uppercase font-semibold",style:{color:"var(--text3)"},children:"Weight Tiers"}),(0,b.jsx)("th",{className:"p-3 text-xs uppercase font-semibold",style:{color:"var(--text3)"},children:"Base Price"}),(0,b.jsx)("th",{className:"p-3 text-xs uppercase font-semibold",style:{color:"var(--text3)"},children:"Status"}),(0,b.jsx)("th",{className:"p-3 text-xs uppercase font-semibold w-24",style:{color:"var(--text3)"},children:"Actions"})]})}),(0,b.jsx)("tbody",{children:G?(0,b.jsx)("tr",{children:(0,b.jsx)("td",{colSpan:7,className:"p-8 text-center text-sm",style:{color:"var(--text3)"},children:"Loading…"})}):H.map(a=>{let c;return(0,b.jsxs)("tr",{className:"group border-b hover:bg-[var(--surface-muted)]/50 transition-colors",style:{borderColor:"var(--border)"},children:[(0,b.jsx)("td",{className:"p-3",children:(0,b.jsx)("div",{className:"w-[42px] h-[42px] rounded-lg flex items-center justify-center shrink-0",style:{background:"var(--thumb-bg)"},children:(0,b.jsx)(x,{category:a.category})})}),(0,b.jsxs)("td",{className:"p-3",children:[(0,b.jsx)("p",{className:"font-medium text-sm",style:{color:"var(--text-primary)"},children:a.name}),(0,b.jsx)("p",{className:"font-mono text-xs mt-0.5",style:{color:"var(--text3)"},children:a.sku})]}),(0,b.jsx)("td",{className:"p-3 text-sm",style:{color:"var(--text-secondary)"},children:a.category}),(0,b.jsx)("td",{className:"p-3",children:(0,b.jsx)("div",{className:"flex flex-wrap gap-1",children:[10,20,30,40].map(c=>a.weight_tiers.some(a=>a.weight_lbs===c)?(0,b.jsxs)("span",{className:"font-mono text-xs px-2 py-0.5 rounded",style:{background:"var(--card2)"},children:[c,"lb"]},c):null)})}),(0,b.jsx)("td",{className:"p-3",children:(c=[...a.weight_tiers].sort((a,b)=>a.weight_lbs-b.weight_lbs)[0])?(0,b.jsxs)("span",{className:"font-mono font-medium",style:{color:"var(--sage)"},children:["$",(c.price_per_lb/100).toFixed(2),"/lb"]}):"—"}),(0,b.jsx)("td",{className:"p-3",children:(0,b.jsxs)("span",{className:(0,v.cn)("inline-flex items-center gap-1.5 text-xs font-medium px-2 py-1 rounded-full",a.in_stock?"bg-[var(--color-success)]/15 text-[var(--color-success)]":"bg-[var(--color-error)]/15 text-[var(--color-error)]"),children:[(0,b.jsx)("span",{className:"w-1.5 h-1.5 rounded-full bg-current"}),a.in_stock?"In Stock":"Out of Stock"]})}),(0,b.jsx)("td",{className:"p-3",children:(0,b.jsxs)("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[(0,b.jsx)("button",{type:"button",onClick:()=>N(a),className:"min-h-[44px] min-w-[44px] flex items-center justify-center rounded-lg hover:bg-[var(--sage-bg)]",style:{color:"var(--sage)"},"aria-label":"Edit",children:(0,b.jsx)(k,{className:"h-4 w-4"})}),(0,b.jsx)("button",{type:"button",onClick:()=>E(a.id),className:"min-h-[44px] min-w-[44px] flex items-center justify-center rounded-lg hover:bg-[var(--color-error)]/15",style:{color:"var(--color-error)"},"aria-label":"Delete",children:(0,b.jsx)(l,{className:"h-4 w-4"})})]})})]},a.id)})})]})})]}),w&&(0,b.jsx)(A,{product:B,onClose:O,onSuccess:()=>{g.invalidateQueries({queryKey:["admin-products"]}),O()},supabase:a}),D&&(0,b.jsx)(z,{onConfirm:async()=>{await a.from("weight_tiers").delete().eq("product_id",D),await a.from("products").delete().eq("id",D),g.invalidateQueries({queryKey:["admin-products"]}),E(null)},onCancel:()=>E(null)})]})}function z({onConfirm:a,onCancel:d}){let[e,f]=(0,c.useState)(!1);return(0,b.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",style:{background:"rgba(0,0,0,0.5)"},children:(0,b.jsxs)("div",{className:"rounded-2xl border p-6 max-w-sm w-full",style:{background:"var(--card)",borderColor:"var(--border)"},children:[(0,b.jsx)("p",{className:"font-display font-semibold",style:{color:"var(--text-primary)"},children:"Delete product?"}),(0,b.jsx)("p",{className:"text-sm mt-1",style:{color:"var(--text3)"},children:"This cannot be undone."}),(0,b.jsxs)("div",{className:"flex gap-3 mt-6",children:[(0,b.jsx)("button",{type:"button",onClick:d,className:"btn-ghost flex-1 min-h-[44px]",children:"Cancel"}),(0,b.jsx)("button",{type:"button",onClick:async()=>{f(!0);try{await a()}finally{f(!1)}},disabled:e,className:"flex-1 min-h-[44px] rounded-xl font-semibold",style:{background:"var(--color-error)",color:"white"},children:e?"Deleting…":"Delete"})]})]})})}function A({product:a,onClose:d,onSuccess:e,supabase:f}){let g=!!a,[h,i]=(0,c.useState)(a?.name??""),[j,k]=(0,c.useState)(a?.category??"Chicken"),[l,m]=(0,c.useState)(a?.cut_type??""),[n,o]=(0,c.useState)(a?.sku??""),[p,q]=(0,c.useState)({10:a?.weight_tiers?.find(a=>10===a.weight_lbs)?.price_per_lb??0,20:a?.weight_tiers?.find(a=>20===a.weight_lbs)?.price_per_lb??0,30:a?.weight_tiers?.find(a=>30===a.weight_lbs)?.price_per_lb??0,40:a?.weight_tiers?.find(a=>40===a.weight_lbs)?.price_per_lb??0}),[r,s]=(0,c.useState)(a?.usda_grade??"N/A"),[t,u]=(0,c.useState)(a?.serving_size??""),[x,y]=(0,c.useState)(a?.in_stock??!0),[z,A]=(0,c.useState)(null),[B,C]=(0,c.useState)(!1),D=async()=>{if(A(null),!h.trim())return void A("Product name is required.");if(!p["10"]||p["10"]<=0)return void A("10lb tier price is required.");C(!0);try{if(g&&a){await f.from("products").update({name:h.trim(),category:j,cut_type:l.trim(),sku:n.trim()||w(h),usda_grade:"N/A"===r?null:r,serving_size:t.trim()||"—",in_stock:x,updated_at:new Date().toISOString()}).eq("id",a.id);let{error:b}=await f.from("weight_tiers").delete().eq("product_id",a.id);if(b)throw b;for(let b of[10,20,30,40])await f.from("weight_tiers").insert({product_id:a.id,weight_lbs:b,price_per_lb:p[String(b)]})}else{let a=w(h)+"-"+Date.now().toString(36),{data:b,error:c}=await f.from("products").insert({name:h.trim(),slug:a,description:"",category:j,cut_type:l.trim(),sku:n.trim()||a.toUpperCase().slice(0,12),images:[],serving_size:t.trim()||"—",usda_grade:"N/A"===r?null:r,in_stock:x}).select("id").single();if(c)throw c;if(!b?.id)throw Error("Insert failed");for(let a of[10,20,30,40])await f.from("weight_tiers").insert({product_id:b.id,weight_lbs:a,price_per_lb:p[String(a)]})}e()}catch(a){A(a instanceof Error?a.message:"Something went wrong")}finally{C(!1)}};return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"fixed inset-0 z-40",style:{background:"rgba(0,0,0,0.5)"},onClick:d,onKeyDown:a=>"Escape"===a.key&&d(),role:"button",tabIndex:0,"aria-label":"Close overlay"}),(0,b.jsxs)("div",{className:"fixed right-0 top-0 z-50 h-full w-[360px] flex flex-col border-l overflow-y-auto",style:{background:"var(--card)",borderColor:"var(--border)"},children:[(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 border-b",style:{borderColor:"var(--border)"},children:[(0,b.jsx)("h2",{className:"font-display text-lg font-semibold",style:{color:"var(--text-primary)"},children:g?"Edit Product":"Add Product"}),(0,b.jsx)("button",{type:"button",onClick:d,className:"min-h-[44px] min-w-[44px] flex items-center justify-center rounded-lg hover:bg-[var(--surface-muted)]",style:{color:"var(--text3)"},"aria-label":"Close",children:(0,b.jsx)("span",{className:"text-xl leading-none",children:"×"})})]}),(0,b.jsxs)("div",{className:"p-4 space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-xs font-semibold uppercase mb-1.5",style:{color:"var(--text3)"},children:"Product Name"}),(0,b.jsx)("input",{type:"text",value:h,onChange:a=>i(a.target.value),className:"input min-h-[44px]",style:{background:"var(--surface-muted)",borderColor:"var(--border)"}})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-xs font-semibold uppercase mb-1.5",style:{color:"var(--text3)"},children:"Category"}),(0,b.jsxs)("select",{value:j,onChange:a=>k(a.target.value),className:"input min-h-[44px]",style:{background:"var(--surface-muted)",borderColor:"var(--border)"},children:[(0,b.jsx)("option",{value:"Chicken",children:"Chicken"}),(0,b.jsx)("option",{value:"Beef",children:"Beef"}),(0,b.jsx)("option",{value:"Pork",children:"Pork"})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-xs font-semibold uppercase mb-1.5",style:{color:"var(--text3)"},children:"Cut Type"}),(0,b.jsx)("input",{type:"text",value:l,onChange:a=>m(a.target.value),className:"input min-h-[44px]",style:{background:"var(--surface-muted)",borderColor:"var(--border)"}})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-xs font-semibold uppercase mb-1.5",style:{color:"var(--text3)"},children:"SKU"}),(0,b.jsx)("input",{type:"text",value:n,onChange:a=>o(a.target.value),placeholder:"Auto-generated",className:"input min-h-[44px] font-mono",style:{background:"var(--surface-muted)",borderColor:"var(--border)"}})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"block text-xs font-semibold uppercase mb-2",style:{color:"var(--text3)"},children:"Pricing Tiers (price per lb in cents)"}),(0,b.jsx)("div",{className:"grid grid-cols-2 gap-3",children:[10,20,30,40].map(a=>(0,b.jsxs)("div",{className:"rounded-xl border p-3",style:{background:"var(--surface-muted)",borderColor:"var(--border)"},children:[(0,b.jsxs)("label",{className:"block text-xs mb-1",style:{color:"var(--text3)"},children:[a,"lb"]}),(0,b.jsx)("input",{type:"number",min:0,value:p[String(a)]||"",onChange:b=>q(c=>({...c,[String(a)]:Number(b.target.value)||0})),className:"input min-h-[40px] font-mono text-sm py-2",style:{background:"var(--card)",borderColor:"var(--border)"}})]},a))})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-xs font-semibold uppercase mb-1.5",style:{color:"var(--text3)"},children:"USDA Grade"}),(0,b.jsxs)("select",{value:r,onChange:a=>s(a.target.value),className:"input min-h-[44px]",style:{background:"var(--surface-muted)",borderColor:"var(--border)"},children:[(0,b.jsx)("option",{value:"Choice",children:"Choice"}),(0,b.jsx)("option",{value:"Select",children:"Select"}),(0,b.jsx)("option",{value:"Prime",children:"Prime"}),(0,b.jsx)("option",{value:"N/A",children:"N/A"})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-xs font-semibold uppercase mb-1.5",style:{color:"var(--text3)"},children:"Serving Size"}),(0,b.jsx)("input",{type:"text",value:t,onChange:a=>u(a.target.value),className:"input min-h-[44px]",style:{background:"var(--surface-muted)",borderColor:"var(--border)"}})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("span",{className:"text-sm",style:{color:"var(--text-secondary)"},children:"In Stock"}),(0,b.jsx)("button",{type:"button",role:"switch","aria-checked":x,onClick:()=>y(a=>!a),className:(0,v.cn)("w-11 h-6 rounded-full transition-colors relative",x?"bg-[var(--sage)]":"bg-[var(--card2)]"),children:(0,b.jsx)("span",{className:(0,v.cn)("absolute top-1 w-4 h-4 rounded-full bg-white transition-transform",x?"left-6":"left-1")})})]})]}),(0,b.jsxs)("div",{className:"p-4 border-t mt-auto",style:{borderColor:"var(--border)"},children:[z&&(0,b.jsx)("p",{className:"text-sm mb-3",style:{color:"var(--color-error)"},children:z}),(0,b.jsxs)("div",{className:"flex gap-3",children:[(0,b.jsx)("button",{type:"button",onClick:d,className:"btn-ghost flex-1 min-h-[44px]",children:"Cancel"}),(0,b.jsx)("button",{type:"button",onClick:D,disabled:B,className:"btn-primary flex-1 min-h-[44px]",children:B?"Saving…":"Save"})]})]})]})]})}a.s(["default",()=>y],54276)}];

//# sourceMappingURL=445e3_brasena_Brasena_apps_web_src_app_%28admin%29_admin_products_page_tsx_f4fc05c7._.js.map